<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<object-views xmlns="http://axelor.com/xml/ns/object-views"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://axelor.com/xml/ns/object-views
  http://axelor.com/xml/ns/object-views/object-views_5.0.xsd">
  
	<chart name="chart.unpaid.invoice.per.customer.bar" title="Unpaid invoices per customer"
		onInit="action.chart.set.from.to.date.month">
		<search-fields>
			<field name="fromDate" type="date" title="From Date"
				x-required="true" />
			<field name="toDate" type="date" title="To Date" x-required="true" />
		</search-fields>
		<dataset type="sql">
		    <![CDATA[
             SELECT 
                count(_invoice.id) AS invoice,
                _party.name AS customer  
             FROM 
                gst_invoice AS _invoice
             JOIN
                gst_party AS _party ON _party.id = _invoice.party
             WHERE
               _party.is_customer = true AND
               _invoice.status_select < '3'
               AND DATE(_invoice.invoice_date) BETWEEN DATE(:fromDate) AND DATE(:toDate)
             GROUP BY
                customer    
		    ]]>
	    </dataset>
		<category key="customer" type="text" title="customer" />
		<series key="invoice" type="bar" title="invoice" />
	</chart>

	<chart name="chart.paid.invoice.per.category.per.product.bar"
		title="Paid invoices per category per product" onInit="action.chart.set.from.to.date.month"
		stacked="true">
		<search-fields>
			<field name="fromDate" type="date" title="From Date"
				x-required="true" />
			<field name="toDate" type="date" title="To Date" x-required="true" />
		</search-fields>
		<dataset type="sql">
		    <![CDATA[
                SELECT 
                   count(_product.id) AS product,
                   _product.name AS product_name,  
                   _productCategory.name AS product_category_name  
                FROM
                   gst_invoice as _invoice
                JOIN
                   gst_invoice_invoice_items_list AS _itemsList ON _itemsList.gst_invoice = _invoice.id
                JOIN
                   gst_invoice_line AS _invoiceLine ON _invoiceLine.id = _itemsList.invoice_items_list
                JOIN
                   gst_product AS _product ON _invoiceLine.product = _product.id
                JOIN
                   gst_product_category AS _productCategory ON _productCategory.id = _product.category
                WHERE
                   _invoice.status_select > '2'
                   AND DATE(_invoice.invoice_date) BETWEEN DATE(:fromDate) AND DATE(:toDate)
                GROUP BY
                  product_name,product_category_name                 
		    ]]>
	    </dataset>
		<category key="product_category_name" type="text" title="Product Category" />
		<series key="product" type="bar" title="Product" groupBy="product_name" />
	</chart>
	
		<chart name="chart.customers.by.party.pie" title="Customers per state">
		<dataset type="sql">
		    <![CDATA[
			SELECT
			    count(_party.id) AS party,
			    _state.name AS state_name
			FROM
				gst_party AS _party
			JOIN
			    gst_party_address_list AS _addressList ON 	_party.id = _addressList.gst_party
		    JOIN
			    gst_address AS _address ON 	_address.id = _addressList.address_list
			JOIN
			    gst_state as _state ON _address.state = _state.id    
			WHERE
				_party.is_customer = true		
			GROUP BY
				state_name
		    ]]>
	    </dataset>
		<category key="state_name" type="text" title="State" />
		<series key="party" type="pie" title="Party" />
	</chart>

	<chart name="chart.invoice.per.status.amount.bar" title="Invoices per status per amount"
		onInit="action.chart.set.from.to.date.month" stacked="true">
		<dataset type="sql">
		    <![CDATA[
                SELECT 
                   SUM(_invoice.gross_amount) AS amount,
                   selection.title AS status  
                FROM
                   gst_invoice as _invoice
                JOIN
                   meta_select_item AS selection ON selection.select_id = 19 AND selection.value = _invoice.status_select     
                GROUP BY
                  status                
		    ]]>
	    </dataset>
		<category key="status" type="text" title="Status" />
		<series key="amount" groupBy="status" type="bar" title="Amount" />
	</chart>

	<chart name="chart.no.of.invoice.per.status.line" title="No. of invoices per status"
		onInit="action.chart.set.from.to.date.month" stacked="true">
		<dataset type="sql">
		    <![CDATA[
                SELECT 
                   count(_invoice.id) AS invoices,
                   selection.title AS status
                FROM
                   gst_invoice as _invoice
                JOIN
                   meta_select_item AS selection ON selection.select_id = 19 AND selection.value = _invoice.status_select     
                GROUP BY
                  status               
		    ]]>
	    </dataset>
		<category key="status" type="text" title="Status" />
		<series key="invoices" groupBy="status" type="line" title="Amount" />
	</chart>

	<action-record name="action.chart.set.from.to.date.month"
		model="com.axelor.gst.db.Invoice">
		<field name="fromDate" expr="eval:__date__.withDayOfYear(1)" />
		<field name="toDate" expr="eval: (__date__.isLeapYear()) ? __date__.withDayOfYear(366): __date__.withDayOfYear(365)" />
	</action-record>

</object-views>